{% extends "base.html" %}
{% block content %}
<div class="row" style="gap:20px;align-items:flex-start">
  <div class="card" style="flex:1;max-width:520px">
    {% if p.imagen %}<img src="{{ p.imagen.url }}" alt="{{ p.nombre }}">{% else %}<img src="https://via.placeholder.co/800x500?text=GAON" alt="{{ p.nombre }}">{% endif %}
  </div>
  <div style="flex:1">
    <h1>{{ p.nombre }}</h1>
    <div class="price" style="font-size:1.4rem;margin:.3rem 0">${{ p.precio }}</div>
    <p>{{ p.descripcion|default:"" }}</p>
    <p>Categor√≠a: {{ p.category|default:"-" }} | Stock: {{ p.stock }}</p>
    <div class="row" style="gap:8px">
      <input id="qty" type="number" min="1" value="1" style="width:90px">
      <button class="btn" onclick="add()">Agregar al carrito</button>
      <a class="btn outline" href="/cart/">Ver carrito</a>
    </div>
  </div>
</div>
<script>
function getCsrf(){const n='csrftoken=';return (document.cookie.split(';').map(c=>c.trim()).find(c=>c.startsWith(n))||'').slice(n.length)||''}
async function add(){
  const qty=parseInt(document.getElementById('qty').value||'1',10);
  await fetch('/api/cart/add/',{method:'POST',headers:{'Content-Type':'application/json','X-CSRFToken':getCsrf()},body:JSON.stringify({product_id:{{ p.id }},qty})});
  alert('Agregado');
}
</script>
{% endblock %}
