{% extends "base.html" %}
{% block content %}
<h1>Eliminar producto</h1>
<div class="card pad" style="max-width:720px">
  <p>¿Seguro que querés borrar <strong>{{ obj.nombre }}</strong>?</p>
  <form method="post">
    {% csrf_token %}
    <div class="row" style="gap:8px;margin-top:8px">
      <button class="btn" type="submit">Sí, borrar</button>
      <a href="/products/manage/" class="btn outline">Cancelar</a>
    </div>
  </form>
</div>
<script>
  // Sincroniza el input csrfmiddlewaretoken con la cookie antes de enviar
  (function(){
    function getCookie(name){
      const parts = document.cookie.split(';').map(c=>c.trim());
      const match = parts.find(p => p.startsWith(name + '='));
      return match ? decodeURIComponent(match.split('=')[1]) : '';
    }
    const form = document.querySelector('form[method="post"]');
    if(!form) return;
    form.addEventListener('submit', function(){
      try{
        const cookieVal = getCookie('csrftoken');
        const input = form.querySelector('input[name="csrfmiddlewaretoken"]');
        if(input && cookieVal){
          input.value = cookieVal;
        }
      }catch(e){ console.error('Error syncing csrf token (delete):', e); }
    });
  })();
</script>
{% endblock %}