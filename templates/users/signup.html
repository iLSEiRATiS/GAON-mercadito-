{% extends "base.html" %}
{% load static %}
{% block title %}Crear cuenta — GAON{% endblock %}

{% block content %}
<section class="auth-section">
  <div class="auth-card">
    <div class="auth-side">
      <img src="{% static 'home/hero2.jpg' %}" alt="Registrarse" class="auth-img" />
    </div>
    <div class="auth-form">
      <h1>Crear cuenta</h1>
      <p class="text-muted">Unite a GAON Mercadito y empezá a comprar o vender</p>

      <form id="signupForm" class="auth-fields">
        <input name="username" placeholder="Usuario" required>
        <input name="email" placeholder="Email" type="email" required>
        <input name="password" placeholder="Contraseña" type="password" required>
        <button class="btn" type="submit">Registrarse</button>
      </form>

      <p id="msg" class="auth-msg"></p>

      <div class="auth-alt">
        <span>o crear cuenta con:</span>
        <div class="auth-social">
          <a href="/accounts/google/login/" class="social google" title="Google" aria-label="Google">
            <svg viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M21.35 11.1H12v2.9h5.3c-.23 1.5-1.8 4.4-5.3 4.4-3.2 0-5.8-2.7-5.8-6s2.6-6 5.8-6c1.8 0 3 .8 3.7 1.5l2-2C16.5 3.8 14.4 3 12 3 6.9 3 2.8 7 2.8 12s4.1 9 9.2 9c5.3 0 8.8-3.7 8.8-9 0-.6-.1-1.1-.2-1.9Z"/></svg>
          </a>
          <a href="/accounts/github/login/" class="social github" title="GitHub" aria-label="GitHub">
            <svg viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 .5A11.5 11.5 0 0 0 8.4 22.9c.6.1.8-.3.8-.6v-2.2c-3.3.7-4-1.4-4-1.4-.6-1.4-1.5-1.8-1.5-1.8-1.2-.8.1-.8.1-.8 1.3.1 2 1.4 2 1.4 1.2 2 3.2 1.4 4 .9.1-.9.5-1.4.9-1.8-2.7-.3-5.5-1.4-5.5-6.1 0-1.3.5-2.4 1.3-3.2-.1-.3-.6-1.6.1-3.3 0 0 1-.3 3.3 1.3a11.3 11.3 0 0 1 6 0C18.9 4.7 20 5 20 5c.6 1.7.2 3 .1 3.3.8.8 1.3 1.9 1.3 3.2 0 4.7-2.8 5.8-5.5 6.1.5.4 1 1.2 1 2.5v3.7c0 .3.2.7.8.6A11.5 11.5 0 0 0 12 .5Z"/></svg>
          </a>
        </div>
      </div>

      <p class="text-muted" style="margin-top:10px">¿Ya tenés cuenta?
        <a href="/login/" class="link">Iniciar sesión</a>
      </p>
    </div>
  </div>
</section>

<style>
/* mismo look & feel que login */
.auth-section{display:grid;place-items:center;min-height:calc(100dvh - 200px)}
.auth-card{display:flex;flex-wrap:wrap;background:#fff;border-radius:18px;overflow:hidden;box-shadow:0 6px 24px rgba(0,0,0,.08);max-width:880px;width:100%}
.auth-side{flex:1 1 40%;background:#f3faff;display:grid;place-items:center}
.auth-img{width:100%;height:100%;object-fit:cover}
.auth-form{flex:1 1 360px;padding:40px 32px;display:flex;flex-direction:column;justify-content:center}
.auth-form h1{margin:0 0 6px;font-size:1.8rem}
.auth-fields{display:flex;flex-direction:column;gap:10px;margin:12px 0}
.auth-fields input{padding:12px;border:1px solid var(--border);border-radius:10px;font-size:1rem}
.auth-msg{margin-top:8px;color:#555;font-size:.9rem}
.auth-alt{text-align:center;margin-top:16px}
.auth-social{display:flex;justify-content:center;gap:16px;margin-top:8px}
.social{width:50px;height:50px;display:grid;place-items:center;border-radius:50%;color:#fff}
.social.google{background:#ea4335}
.social.github{background:#24292e}
@media(max-width:860px){.auth-side{display:none}}
</style>

<script>
function getCsrf(){const n='csrftoken=';return (document.cookie.split(';').map(c=>c.trim()).find(c=>c.startsWith(n))||'').slice(n.length)||''}
const F=document.getElementById('signupForm');const MSG=document.getElementById('msg');
F.addEventListener('submit',async e=>{
  e.preventDefault();MSG.textContent='Creando cuenta...';
  const fd=new FormData(F);
  const payload={username:fd.get('username'),email:fd.get('email'),password:fd.get('password')};
  try{
    const r=await fetch('/api/auth/users/',{
      method:'POST',headers:{'Content-Type':'application/json','X-CSRFToken':getCsrf()},
      body:JSON.stringify(payload)
    });
    const data=await r.json();
    if(!r.ok)throw new Error(data?.detail||'Error al registrar usuario');
    GAON_UI.toast('Cuenta creada con éxito');
    location.href='/login/';
  }catch(err){
    MSG.textContent='Error: '+err.message;
    GAON_UI.toast('No se pudo registrar','err',err.message);
  }
});
</script>
{% endblock %}
